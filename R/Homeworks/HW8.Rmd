---
title: "Homework 8"
author: "Francis Olakangil"
date: "2023-12-08"
output: html_document
editor_options: 
chunk_output_type: console
---

1. Create a plotly animation plot of Chicago neighborhoods by their fail proportions of food health inspections for the all the years present in the data. (Remove long/lat labels ?theme() and filter out NA community area, https://plotly.com/ggplot2/animations/ )

Compare the changes in inspection fail rates over time.

```{r}
library(tidyverse)
library(lubridate)
library(viridis)
library(janitor)
library(plotly)
library(sf)

data <- read.csv("/Users/fran-pellegrino/Library/CloudStorage/OneDrive-LoyolaUniversityChicago/DSCI101/DSCI_Whalen/data/food_inspections.csv") %>%
  clean_names()
shp_file <- st_read("/Users/fran-pellegrino/Library/CloudStorage/OneDrive-LoyolaUniversityChicago/DSCI101/DSCI_Whalen/Boundaries - Community Areas (current)/geo_export_fabde920-323b-4d32-bd50-ce085291ae52.shp")

data <- data %>%
  filter(!is.na(longitude)) %>%
  st_as_sf(coords = c("longitude", "latitude"),
           crs = st_crs(shp_file))

#food %>%
  #mutate(inspection_date = as.Date(inspection_date, format = "%m/%d/%y"))


data <- data %>%  
  mutate(inspection_date = as_date(inspection_date, format = "%m/%d/%Y"),        
         year = year(inspection_date))

join <- st_join(data, shp_file, join = st_within)

join %>% select(community)

prop_fail <- join %>%
  tibble() %>%
  group_by(community, year) %>%
  summarise(prop_fail = sum(results == "Fail")/n()) %>%
  left_join(shp_file) %>%
  st_as_sf()
 
prop_fail <- prop_fail %>%
  drop_na(comarea)  
prop_fail

prop <- prop_fail %>%
  ggplot() +
  geom_sf(aes(fill=prop_fail, frame = year)) +
  scale_fill_viridis()
ggplotly(prop)
```

